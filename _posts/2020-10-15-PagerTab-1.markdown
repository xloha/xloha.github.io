---
layout: post
title:  "(iOS) PagerTab êµ¬í˜„í•´ë³´ê¸° 1 / 2"
date:   2020-10-15 17:10:00 +0900
categories: iOS swift 
tags:
- CollectionView
- PageViewController
- Delegate
- AutoLayout
---
<br>

í˜ì´ì§€ íƒ­ë°”ë¥¼ ë§Œë“¤ì–´ë³´ê¸°ë¡œ í–ˆë‹¤. ì•ˆë“œë¡œì´ë“œì™€ ë‹¬ë¦¬ iOSëŠ” Pager Tabì„ ì œê³µí•´ì£¼ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§ì´ ì“´ë‹¤ê³  í•œë‹¤. ì „ì²´ ì½”ë“œëŠ” [EUNPPINGMALL](https://github.com/EunYeongKim/EUNPPINGMALL) ì´ê³³ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  

[ì—¬ê¸°ì„œ](https://nsios.tistory.com/44) ë„ì›€ì„ ë§ì´ ë°›ì•˜ê³ , ì½”ë“œë¥¼ ì°¸ê³ í•˜ì˜€ë‹¤. 

## ìµœì¢… ê²°ê³¼ë¬¼~ğŸ‘» 
<img src="/assets/image/SwiftPagerTab.png" style="zoom: 30%;"/> <img src="/assets/image/PagerTabGIF.gif" style="zoom: 60%;"/>

<br>

 `CollectionView, PageViewController, Delegate Pattern`ì„ ì´ìš©í•˜ì˜€ë‹¤.

* `CollectionView`
    * íƒ­ ë©”ë‰´
* `PageViewController`
    * í‘œì‹œí•  í˜ì´ì§€

<br>

â“ `ContainerView` ê°€ ê°€ë¦¬í‚¤ëŠ” `ViewController` ì°¾ëŠ” ë°©ë²•ì€?

âœ…  `self.children`ìœ¼ë¡œ ìì‹ ë·°ë¥¼ ì°¾ëŠ”ë‹¤

<br>

# 1. í™”ë©´ êµ¬ì„±

<img src="/assets/image/image-20201015163624322.png" style="zoom: 50%;">

* `CollectionView`ì— `Cell`ì„ ë„£ì–´ì„œ ë©”ë‰´ë¥¼ ë§Œë“¬
* `UIView`ë¡œ ë©”ë‰´ ì•„ë˜ì˜ ì›€ì§ì¼ ë°”ë¥¼ ë§Œë“¤ì–´ì¤Œ
* ë³´ì—¬ì§ˆ í˜ì´ì§€ ë¶€ë¶„ì—ëŠ” ì»¨í…Œì´ë„ˆ ë·°ë¥¼ ë„£ê³ , `PagerViewController`ì™€ ì—°ê²°  

<br>

# 2. CollectionView Cell 

```swift
class TabMenuCollectionViewCell: UICollectionViewCell {
    var menuStr: String? {
        didSet {
            guard let menu = menuStr else { return }
            self.menuLabel.text = menu
        }
    }
    
    @IBOutlet weak var menuLabel: UILabel!

    override func prepareForReuse() {
        isSelected = false
    }
}
```
* ê°„ë‹¨í•˜ê²Œ ìœ„ì™€ ê°™ì´ ì‘ì„±í•´ì£¼ë©´ ëœë‹¤.

<br>

# 3. íƒ­ ë©”ë‰´

```swift
let menu = ["PRODUCT", "RECENT", "WISHLIST"]
    
@IBOutlet weak var collectionView: UICollectionView!
@IBOutlet weak var menuUnderBar: UIView!

var pageVCDelegate: PageViewControllerDelegate?
var constraints: [NSLayoutConstraint] = []
```
* `var pageVCDelegate` : ë©”ë‰´ íƒ­ì„ ëˆŒë €ì„ ì‹œì— `PageViewController`ê°€ ì²˜ë¦¬í•´ ì¤„ í˜ì´ì§€ ì „í™˜ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´
* `var constraints` : ë©”ë‰´ íƒ­ì„ ëˆŒë €ì„ ì‹œì— ë©”ë‰´ë°”ê°€ ì›€ì§ì¼ ë•Œ Constraintsì˜ ì˜¤ë¥˜ë¥¼ ì—†ì• ê¸° ìœ„í•´

<br>

## ì´ˆê¸° ì„¤ì •ì„ ìœ„í•œ ë©”ì†Œë“œ 

```swift
func setFirstIndexIsSelected() {
    let selectedIndexPath = IndexPath(item: 0, section: 0)
    collectionView(collectionView, didSelectItemAt: selectedIndexPath)
    collectionView.selectItem(at: selectedIndexPath, animated: false, scrollPosition: .right)
}

func setDelegate() {
    guard let vc = self.children.first as? TabMenuPageViewController else { return }
    vc.menuDelegate = self
    vc.setDelegate(self)
}
```
<br>

## ë©”ë‰´ ë°” ì´ë™
```swift
func moveMenuUnderBar(indexPath: IndexPath) {
    guard let cell = collectionView.cellForItem(at: indexPath) as? TabMenuCollectionViewCell else { return }
    
    NSLayoutConstraint.deactivate(constraints)
    menuUnderBar.translatesAutoresizingMaskIntoConstraints = false
    constraints = [ menuUnderBar.leadingAnchor.constraint(equalTo: cell.leadingAnchor), menuUnderBar.trailingAnchor.constraint(equalTo: cell.trailingAnchor) ]
    NSLayoutConstraint.activate(constraints)
    
    UIView.animate(withDuration: 0.3) { self.view.layoutIfNeeded() }
}
```
* ì™„ì „ ê³¨ì ¸ìŠ¤í•œ ì½”ë“œì—¬ì„œ ê°–ê³ ì™”ë‹¤,,,,,ì²´ê³ ğŸ‘

<br>

## ë©”ë‰´ ë°” ë„ˆë¹„ ì¡°ì •
```swift
extension TabMenuViewController: UICollectionViewDelegateFlowLayout {
    func collectionView(_ collectionView: UICollectionView, layout collectionViewLayout: UICollectionViewLayout, sizeForItemAt indexPath: IndexPath) -> CGSize {
        let width = view.frame.width / CGFloat(menu.count)
        menuUnderBar.frame.size.width = width
        return CGSize(width: width, height: 50)
    }
}
```
* ë‚˜ëŠ” 3ê°œì˜ ë©”ë‰´ë§Œ ë³´ì—¬ì¤„ ê²ƒì´ì—¬ì„œ ë”°ë¡œ widthë¥¼ ê³„ì‚°í•˜ì˜€ë‹¤.

<br>

## `delegate` êµ¬í˜„

```swift
extension TabMenuViewController: PageIndexDelegate {
    func selectMenuItem(pageIndex: Int) {
        let selectedIndexPath = IndexPath(item: pageIndex, section: 0)
        moveMenuUnderBar(indexPath: selectedIndexPath)
    }
}
```
* PagerViewControllerì—ì„œ í™”ë©´ì„ ì§ì ‘ ìŠ¤í¬ë¡¤ í•  ë•Œ í•´ë‹¹ Viewì— ë§ì¶° ë©”ë‰´ë°”ë¥¼ ì›€ì§ì´ë„ë¡ í•´ì£¼ëŠ” í•¨ìˆ˜ì´ë‹¤.

<br>


# `Delegate`ë¥¼ ì£¼ì… í•´ê²°ë°©ë²•

`Pager Tab`ì„ ë§Œë“¤ë©´ì„œ ê³ ë¯¼í–ˆë˜ ë¶€ë¶„ì´ë‹¤.  

## 1. `View`ì˜ ìƒì„± ì‹œê¸° ë¬¸ì œ
<img src="/assets/image/image-20201015163624322.png" style="zoom: 50%;">

* `PagerView`(ìì‹ ë·°)ë¥¼ `ContainerView`(ë¶€ëª¨ ë·°)ì— ë„£ì€ ìƒíƒœ
* ë‚˜ëŠ” ë‹¹ì—°íˆ `ContainerView`ê°€ ìˆëŠ” `ViewController`ê°€ ë¨¼ì € ë¶ˆë¦´ ì¤„ ì•Œì•˜ëŠ”ë° `PagerView`ê°€ ë¨¼ì € ìƒì„±ë˜ê³  `ContainerView`ê°€ ìˆëŠ” `ViewController`ê°€ ê·¸ ë‹¤ìŒ ìƒì„±ì´ ëœë‹¤. 
    * ë¶€ëª¨ ë·°ëŠ” ìì‹ ë·°ì— `delegate`ë¥¼ ì£¼ì…í•´ì•¼í•˜ê³ , ìì‹ ë·°ë„ ë¶€ëª¨ ë·°ì— `delegate` ì£¼ì…í•´ì•¼í•˜ëŠ”ë° ìì‹ ë·°ê°€ ë¨¼ì € ìƒê²¨ë²„ë¦¬ê¸° ë•Œë¬¸ì— ë‚˜ì¤‘ì— ìƒì„±ë˜ëŠ” ë¶€ëª¨ ë·°ì—ì„œ ìì‹ ë·°ì˜ `delegate`ë¥¼ ì£¼ì…í•˜ëŠ” í•¨ìˆ˜ë„ ì‹¤í–‰ì‹œì¼œì£¼ì—ˆë‹¤.

```swift
func setDelegate() {
    guard let vc = self.children.first as? TabMenuPageViewController else { return }
    vc.menuDelegate = self
    vc.setDelegate(self)
}
```
<br>

## 2. ì•Œë§ì€ `View`ë¥¼ ì°¾ì§€ ëª»í•œ ë¬¸ì œ

```swift
UIStoryboard(name: "Main", bundle: nil).instantiateViewController(withIdentifier: name) as? TabMenuPageViewController
```

* ì²˜ìŒì—ëŠ” ìœ„ì™€ ê°™ì´ ì‘ì„±í•´ì„œ `PagerViewController`ë¥¼ ì°¾ì•˜ëŠ”ë° ì´ë ‡ê²Œ ì°¾ì„ ê²½ìš° ì²˜ìŒì— ìƒì„±ëœ ìì‹ ë·°ê°€ ì•„ë‹Œ ìƒˆë¡œìš´ ë·°ì´ê¸° ë•Œë¬¸ì— `delegateì£¼ì…`ì´ ì œëŒ€ë¡œ ë˜ì§€ ì•ŠëŠ”ë‹¤
* ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì´ ìì‹ ë·°ë¥¼ í†µí•´ ì°¾ì•„ì•¼ í•œë‹¤.


```swift
self.children.first as? TabMenuPageViewController
```

<br>
<br>

ë‚˜ë¨¸ì§€ëŠ” ë‹¤ ì´í•´ê°€ëŠ¥í•œ ë¶€ë¶„ì´ì—¬ì„œ ì„¤ëª…ì„ ìƒëµí•œë‹¤.